#!/usr/bin/env bash
set -euo pipefail

# Project-local wrapper around the Node-based Babulus CLI.
#
# Usage:
#   bin/babulus generate
#   bin/babulus sfx next --clip whoosh --variants 8 --apply

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
LOCAL_BIN="$ROOT_DIR/node_modules/.bin/babulus"

if [[ -x "$LOCAL_BIN" ]]; then
  export PATH="$ROOT_DIR/node_modules/.bin:$PATH"
  exec "$LOCAL_BIN" "$@"
fi

if command -v babulus >/dev/null 2>&1; then
  exec babulus "$@"
fi

if command -v npx >/dev/null 2>&1; then
  exec npx --no-install babulus "$@"
fi

echo "babulus: CLI not found. Run 'npm install' in $ROOT_DIR or install babulus globally." >&2
exit 127
